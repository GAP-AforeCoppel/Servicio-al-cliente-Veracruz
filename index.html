<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Servicio al cliente - Segmento Veracruz</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f3f4f6;
        }
        
        .coppel-blue { color: #0056b3; }
        .bg-coppel-blue { background-color: #0056b3; }
        .coppel-yellow { color: #ffd200; }
        .bg-coppel-yellow { background-color: #ffd200; }
        
        .script-box {
            background-color: #ffffff;
            border-left: 6px solid #0056b3;
            transition: all 0.3s ease;
        }

        /* Estilo espec铆fico para el script de apertura */
        .opening-box {
            background-color: #ffffff;
            border-left: 6px solid #ffd200; /* Amarillo para diferenciar apertura */
        }

        /* Estilo para script de no contacto */
        .non-contact-box {
            background-color: #fff1f2;
            border-left: 6px solid #e11d48;
        }

        /* Estilo para script de 茅xito (Cierre 2) */
        .success-box {
            background-color: #f0fdf4;
            border-left: 6px solid #16a34a;
        }

        .fade-in {
            animation: fadeIn 0.5s;
        }

        /* Animaci贸n de flotaci贸n para el badge */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0px); }
        }
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
        
        /* Animaci贸n para modales */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up {
            animation: fadeInUp 0.4s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .obj-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* Tabla comparativa */
        .comparison-table th, .comparison-table td {
            border: 1px solid #e5e7eb;
            padding: 12px 16px;
            font-size: 0.85rem;
            vertical-align: middle;
        }
        .comparison-table th {
            background-color: #f3f4f6;
            font-weight: 800;
            text-transform: uppercase;
            color: #374151;
            position: sticky;
            top: 0;
            z-index: 10;
            text-align: left;
        }
        .comparison-table .highlight-coppel {
            background-color: #eff6ff;
            border-left: 4px solid #0056b3;
            font-weight: 600;
            color: #1e3a8a;
        }
        .comparison-table .competitor-col {
            background-color: #fff1f2;
            border-left: 4px solid #e11d48;
            font-weight: 500;
            color: #881337;
        }

        /* Scrollbar personalizado */
        .custom-scroll::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 2px;
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-coppel-blue text-white p-4 shadow-lg flex justify-between items-center z-10">
        <div class="flex items-center gap-3 w-full max-w-4xl">
            <!-- LOGO COPPEL (PNG) -->
            <div class="flex-shrink-0">
                <img src="Coppel2 (3).png" alt="Coppel Logo" class="h-10 w-auto">
            </div>
            
            <div class="overflow-hidden border-l border-blue-400 pl-3">
                <h1 class="text-xl font-bold truncate">Servicio al cliente</h1>
                <p class="text-sm text-yellow-300 leading-tight opacity-90 font-medium">
                    Veracruz
                </p>
            </div>
        </div>
        <div class="flex gap-4 items-center flex-shrink-0">
            <div class="text-right hidden md:block">
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="flex flex-1 overflow-hidden">
        
        <!-- Sidebar: Inputs -->
        <aside class="w-full md:w-1/3 lg:w-3/12 bg-white border-r border-gray-200 p-4 flex flex-col gap-4 overflow-y-auto z-10 shadow-md custom-scroll">
            
            <div class="bg-yellow-50 border border-yellow-200 p-3 rounded-lg text-xs text-yellow-800 mb-2">
                <i class="fa-solid fa-info-circle mr-1"></i>
                <b>Instrucci贸n:</b> Realice el saludo inicial (a la derecha). Cuando el cliente le diga el motivo, selecci贸nelo aqu铆 abajo.
            </div>

            <!-- Selector Afore -->
            <div>
                <label class="block text-gray-700 text-xs font-bold mb-1 uppercase tracking-wide">
                    1. 驴A qu茅 Afore se va?
                </label>
                <div class="relative">
                    <select id="competitorSelect" onchange="generateScript()" class="block appearance-none w-full bg-gray-50 border border-gray-300 text-gray-700 py-2 px-3 pr-8 rounded leading-tight focus:outline-none focus:bg-white focus:border-blue-500 transition-colors cursor-pointer shadow-sm text-sm">
                        <option value="" disabled selected>Seleccione la Afore...</option>
                        <option value="profuturo">Profuturo</option>
                        <option value="banorte">XXI Banorte</option>
                        <option value="banamex">Citibanamex</option>
                        <option value="inbursa">Inbursa</option>
                        <option value="azteca">Azteca</option>
                        <option value="sura">Sura</option>
                        <option value="principal">Principal</option>
                        <option value="invercap">InverCap</option>
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                        <i class="fa-solid fa-chevron-down text-xs"></i>
                    </div>
                </div>
            </div>

            <!-- Selector Motivo -->
            <div>
                <label class="block text-gray-700 text-xs font-bold mb-1 uppercase tracking-wide">
                    2. 驴Cu谩l es el motivo?
                </label>
                <div class="grid grid-cols-1 gap-2">
                    <!-- BOTN 1: SERVICIO -->
                    <button onclick="setReason('service')" id="btn-service" class="reason-btn flex items-center p-3 border rounded-xl hover:bg-blue-50 transition-all text-left group focus:outline-none shadow-sm w-full">
                        <div class="bg-blue-100 text-blue-600 rounded-full h-10 w-10 flex-shrink-0 flex items-center justify-center mr-3 group-hover:bg-blue-600 group-hover:text-white transition-colors">
                            <i class="fa-solid fa-headset text-lg"></i>
                        </div>
                        <div>
                            <p class="font-bold text-sm text-gray-800">Servicio</p>
                            <p class="text-xs text-gray-500">Mala atenci贸n o procesos</p>
                        </div>
                    </button>

                    <!-- BOTN 2: COBERTURA / HORARIOS -->
                    <button onclick="setReason('coverage')" id="btn-coverage" class="reason-btn flex items-center p-3 border rounded-xl hover:bg-green-50 transition-all text-left group focus:outline-none shadow-sm w-full">
                        <div class="bg-green-100 text-green-600 rounded-full h-10 w-10 flex-shrink-0 flex items-center justify-center mr-3 group-hover:bg-green-600 group-hover:text-white transition-colors">
                            <i class="fa-solid fa-clock text-lg"></i>
                        </div>
                        <div>
                            <p class="font-bold text-sm text-gray-800">Cobertura / Horarios</p>
                            <p class="text-xs text-gray-500">Ubicaci贸n, d铆as y horarios</p>
                        </div>
                    </button>

                    <!-- BOTN 3: RENDIMIENTOS -->
                    <button onclick="setReason('returns')" id="btn-returns" class="reason-btn flex items-center p-3 border rounded-xl hover:bg-yellow-50 transition-all text-left group focus:outline-none shadow-sm w-full">
                        <div class="bg-yellow-100 text-yellow-600 rounded-full h-10 w-10 flex-shrink-0 flex items-center justify-center mr-3 group-hover:bg-yellow-500 group-hover:text-white transition-colors">
                            <i class="fa-solid fa-chart-line text-lg"></i>
                        </div>
                        <div>
                            <p class="font-bold text-sm text-gray-800">Rendimientos</p>
                            <p class="text-xs text-gray-500">Busca ganar m谩s dinero</p>
                        </div>
                    </button>
                </div>
            </div>

            <!-- COMPARATIVE DATA CARD (Dynamic) -->
            <div id="data-card" class="hidden flex-1 bg-white border border-gray-200 rounded-lg shadow-md overflow-hidden flex flex-col mt-4">
                <div class="bg-gray-100 p-2 border-b border-gray-200 flex justify-between items-center">
                    <h4 class="font-bold text-xs text-gray-700 uppercase">VS. <span id="comp-name-display"></span></h4>
                    <span class="text-[10px] bg-blue-100 text-blue-800 px-1 rounded">Veracruz</span>
                </div>
                <div id="comparison-content" class="p-0 overflow-y-auto text-xs">
                    <!-- Dynamic Rows Go Here -->
                </div>
            </div>

        </aside>

        <!-- Main Display: Generated Script -->
        <main class="flex-1 p-4 md:p-8 bg-gray-100 flex flex-col justify-start items-center pt-8 relative overflow-y-auto">
            
            <!-- OPENING SCRIPT (Inicio de Llamada) -->
            <div id="opening-script" class="w-full max-w-3xl fade-in">
                
                <div class="flex items-center justify-between mb-4 px-2">
                    <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider shadow-sm">
                        <i class="fa-solid fa-phone mr-1"></i> Fase 1: Apertura
                    </span>
                </div>

                <div class="opening-box shadow-xl rounded-xl p-6 md:p-8 relative mb-6">
                    <!-- Paso 1 -->
                    <div class="mb-6 relative pl-4 border-l-2 border-gray-200">
                        <div class="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-gray-300"></div>
                        <h4 class="text-xs font-bold text-gray-400 uppercase mb-1 flex justify-between items-center">
                            Paso 1: Saludo y Contacto
                        </h4>
                        <p class="text-lg text-gray-800 mb-3">
                            "Hola, buen d铆a, le hablo de Afore Coppel, soy <span class="font-bold text-blue-600">[Su Nombre]</span>. 驴Me podr铆a comunicar, por favor, con <span class="font-bold text-blue-600">[Nombre del Trabajador]</span>?"
                        </p>
                        
                        <!-- BOTONES DE CONTACTO NO EFECTIVO -->
                        <div class="mt-3 bg-gray-50 p-3 rounded-lg border border-gray-200">
                            <p class="text-xs text-gray-500 font-bold uppercase mb-2">Si NO es el titular o no est谩:</p>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="showNonContact('wrong_number')" class="text-xs bg-red-50 text-red-600 border border-red-200 px-3 py-1.5 rounded hover:bg-red-100 transition-colors flex items-center font-medium">
                                    <i class="fa-solid fa-user-slash mr-1.5"></i> No lo conozco / Equivocado
                                </button>
                                <button onclick="showNonContact('not_home')" class="text-xs bg-orange-50 text-orange-600 border border-orange-200 px-3 py-1.5 rounded hover:bg-orange-100 transition-colors flex items-center font-medium">
                                    <i class="fa-regular fa-clock mr-1.5"></i> No se encuentra (Recado)
                                </button>
                                <button onclick="showNonContact('deceased')" class="text-xs bg-gray-100 text-gray-600 border border-gray-300 px-3 py-1.5 rounded hover:bg-gray-200 transition-colors flex items-center font-medium">
                                    <i class="fa-solid fa-ribbon mr-1.5"></i> Falleci贸
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Paso 2 -->
                    <div class="mb-6 relative pl-4 border-l-2 border-gray-200">
                        <div class="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-gray-300"></div>
                        <h4 class="text-xs font-bold text-gray-400 uppercase mb-1">Paso 2: Motivo de Llamada</h4>
                        <p class="text-lg text-gray-800">
                            "Mucho gusto <span class="font-bold text-blue-600">[Nombre]</span>, el motivo de mi llamada es porque hemos recibido su solicitud de cambio a <span class="font-bold text-red-500">[Nombre de Afore Competencia]</span>. 驴S铆 lo solicit贸 usted?"
                        </p>
                        <p class="text-sm text-gray-500 italic mt-1 font-semibold">
                            (Si dice "NO", generar registro en Salesforce. Si dice "S", continuar )
                        </p>
                    </div>

                    <!-- Paso 3 -->
                    <div class="relative pl-4 border-l-2 border-yellow-400">
                        <div class="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-yellow-400 animate-pulse"></div>
                        <h4 class="text-xs font-bold text-yellow-600 uppercase mb-1">Paso 3: Pregunta Clave (Sondeo)</h4>
                        <p class="text-lg text-gray-900 font-medium">
                            "Entiendo. Quiero mencionarle que valoramos mucho los a帽os que ha confiado en Afore Coppel y es por ello que me gustar铆a saber: <br><br>
                            <span class="bg-yellow-100 px-1 rounded">驴Cu谩l es la raz贸n principal de su cambio?</span>"
                        </p>
                        <p class="text-sm text-gray-500 italic mt-2">
                             Escuche al cliente y <b>seleccione el motivo</b> en el men煤 de la izquierda para ver qu茅 responder.
                        </p>
                    </div>
                </div>
            </div>

            <!-- NON-CONTACT SCRIPT (Contacto No Efectivo) - Hidden by default -->
            <div id="non-contact-script" class="hidden w-full max-w-3xl fade-in pb-20">
                <!-- Back Button -->
                <button onclick="resetApp()" class="mb-4 text-gray-500 hover:text-blue-600 flex items-center font-medium transition-colors group">
                    <i class="fa-solid fa-arrow-left mr-2 group-hover:-translate-x-1 transition-transform"></i>
                    Regresar al Inicio
                </button>

                <div class="flex items-center justify-between mb-4 px-2">
                    <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider shadow-sm">
                        <i class="fa-solid fa-user-xmark mr-1"></i> Contacto No Efectivo
                    </span>
                </div>

                <div class="non-contact-box shadow-xl rounded-xl p-6 md:p-8 relative mb-6">
                    
                    <!-- DYNAMIC NON-CONTACT CONTENT -->
                    <div id="nc-content-area">
                        <h4 id="nc-title" class="text-sm font-bold text-red-700 uppercase mb-3 flex items-center">
                            <!-- JS Injected Title -->
                        </h4>
                        <p id="nc-text" class="text-gray-800 text-lg leading-relaxed mb-4">
                            <!-- JS Injected Script -->
                        </p>
                        <div id="nc-extra" class="bg-red-50 p-3 rounded-lg text-sm text-red-800 mb-4 border border-red-100">
                            <!-- JS Injected Extra Logic -->
                        </div>
                    </div>

                    <!-- CIERRE 1 -->
                    <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm mt-6">
                        <h3 class="text-gray-500 font-bold text-xs uppercase mb-2">
                            <i class="fa-solid fa-phone-slash mr-1"></i> Cierre 1 (Obligatorio)
                        </h3>
                        <p class="text-gray-800 font-medium italic">
                            "Agradezco su atenci贸n, le llam贸 <span class="font-bold">[Su Nombre]</span> de Afore Coppel, 隆Que tenga un excelente d铆a/tarde/noche!"
                        </p>
                    </div>
                </div>
            </div>

            <!-- RETENTION SCRIPT (Argumentaci贸n) - Hidden by default -->
            <div id="script-container" class="hidden w-full max-w-3xl pb-20">
                
                <!-- Back Button -->
                <button onclick="resetApp()" class="mb-4 text-gray-500 hover:text-blue-600 flex items-center font-medium transition-colors group">
                    <i class="fa-solid fa-arrow-left mr-2 group-hover:-translate-x-1 transition-transform"></i>
                    Regresar al Saludo Inicial
                </button>

                <!-- Status Bar -->
                <div class="flex items-center justify-between mb-4 px-2">
                    <div class="flex gap-2">
                        <span id="tag-competitor" class="bg-gray-700 text-white px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider shadow-sm">Vs. Competencia</span>
                        <span id="tag-reason" class="bg-blue-600 text-white px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider shadow-sm">Beneficio Clave</span>
                    </div>
                    <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider shadow-sm">
                        <i class="fa-solid fa-shield-halved mr-1"></i> Fase 2: Retenci贸n
                    </span>
                </div>

                <!-- The Script Box -->
                <div class="script-box shadow-2xl rounded-xl p-6 md:p-8 relative mb-6">
                    <button onclick="copyScript('script-body', 'script-closing')" class="absolute top-4 right-4 text-gray-300 hover:text-blue-600 transition-colors bg-gray-50 hover:bg-blue-50 p-2 rounded-full" title="Copiar guion">
                        <i class="fa-regular fa-copy text-lg"></i>
                    </button>

                    <div class="mb-6">
                        <h3 class="text-blue-600 font-bold text-xs uppercase mb-6 tracking-widest flex items-center">
                             <i class="fa-solid fa-link mr-2"></i> Di谩logo de Conexi贸n
                        </h3>
                        <p id="script-body" class="text-gray-800 text-lg md:text-xl leading-relaxed font-medium font-sans">
                            <!-- Script will be injected here -->
                        </p>
                        <p class="text-sm text-gray-500 italic mt-3 bg-gray-50 p-2 rounded border border-gray-100">
                             <i class="fa-solid fa-info-circle mr-1"></i> Ap贸yese en los datos de la barra lateral (comparativa) para argumentar el beneficio.
                        </p>
                    </div>

                    <div class="bg-gradient-to-r from-yellow-50 to-white rounded-lg p-5 border border-yellow-200 shadow-inner">
                        <h3 class="text-yellow-700 font-bold text-xs uppercase mb-2 flex items-center">
                            <i class="fa-solid fa-handshake mr-2"></i> Cierre de Compromiso
                        </h3>
                        <p id="script-closing" class="text-gray-800 font-medium italic text-lg">
                            <!-- Closing will be injected here -->
                        </p>
                    </div>
                </div>

                <!-- OBJECTION HANDLING SECTION -->
                <div class="border-t-2 border-dashed border-gray-300 pt-6">
                    <h3 class="text-center text-gray-500 font-bold text-sm uppercase mb-4 tracking-wider">
                         Zona de Rescate: Si el cliente NO acepta a la primera
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button onclick="showRebuttal('money')" class="obj-btn bg-white border border-gray-200 p-3 rounded-lg text-left hover:border-green-500 transition-all flex items-center group">
                            <div class="bg-green-100 text-green-600 h-8 w-8 rounded-full flex items-center justify-center mr-3 group-hover:bg-green-600 group-hover:text-white">
                                <i class="fa-solid fa-sack-dollar"></i>
                            </div>
                            <div>
                                <p class="text-xs font-bold text-gray-500 uppercase">Objeci贸n</p>
                                <p class="text-sm font-bold text-gray-800">"Quiero m谩s rendimiento"</p>
                            </div>
                        </button>

                        <button onclick="showRebuttal('distance')" class="obj-btn bg-white border border-gray-200 p-3 rounded-lg text-left hover:border-blue-500 transition-all flex items-center group">
                            <div class="bg-blue-100 text-blue-600 h-8 w-8 rounded-full flex items-center justify-center mr-3 group-hover:bg-blue-600 group-hover:text-white">
                                <i class="fa-solid fa-car"></i>
                            </div>
                            <div>
                                <p class="text-xs font-bold text-gray-500 uppercase">Objeci贸n</p>
                                <p class="text-sm font-bold text-gray-800">"No me importa viajar"</p>
                            </div>
                        </button>

                        <button onclick="showRebuttal('bad_service')" class="obj-btn bg-white border border-gray-200 p-3 rounded-lg text-left hover:border-red-500 transition-all flex items-center group">
                            <div class="bg-red-100 text-red-600 h-8 w-8 rounded-full flex items-center justify-center mr-3 group-hover:bg-red-600 group-hover:text-white">
                                <i class="fa-solid fa-thumbs-down"></i>
                            </div>
                            <div>
                                <p class="text-xs font-bold text-gray-500 uppercase">Objeci贸n</p>
                                <p class="text-sm font-bold text-gray-800">"Me atendieron mal"</p>
                            </div>
                        </button>

                        <button onclick="showRebuttal('status_quo')" class="obj-btn bg-white border border-gray-200 p-3 rounded-lg text-left hover:border-purple-500 transition-all flex items-center group">
                            <div class="bg-purple-100 text-purple-600 h-8 w-8 rounded-full flex items-center justify-center mr-3 group-hover:bg-purple-600 group-hover:text-white">
                                <i class="fa-solid fa-clipboard-check"></i>
                            </div>
                            <div>
                                <p class="text-xs font-bold text-gray-500 uppercase">Objeci贸n</p>
                                <p class="text-sm font-bold text-gray-800">"Ya firm茅 / Qu茅 pereza"</p>
                            </div>
                        </button>
                    </div>

                    <!-- Rebuttal Display -->
                    <div id="rebuttal-display" class="hidden mt-4 bg-gray-800 text-white p-6 rounded-lg shadow-lg relative fade-in">
                        <button onclick="closeRebuttal()" class="absolute top-2 right-2 text-gray-400 hover:text-white">
                            <i class="fa-solid fa-times"></i>
                        </button>
                        
                        <h4 class="text-yellow-400 font-bold text-xs uppercase mb-2">
                            <i class="fa-solid fa-shield-cat mr-1"></i> Contra-Argumento
                        </h4>
                        
                        <p id="rebuttal-text" class="text-lg font-medium leading-relaxed"></p>
                        
                        <div class="mt-4 pt-4 border-t border-gray-700 text-center">
                            <p class="text-sm text-gray-400 italic mb-2">Cierre Sugerido:</p>
                            <p class="text-yellow-300 font-bold" id="rebuttal-closing"></p>
                        </div>

                        <button onclick="closeRebuttal()" class="mt-4 w-full text-center text-xs text-gray-400 hover:text-white flex items-center justify-center gap-1 transition-colors">
                             <i class="fa-solid fa-arrow-up"></i> Volver al Guion Principal
                        </button>
                    </div>
                </div>

                <!-- Action Buttons & Cancellation Process -->
                <div class="mt-8 flex justify-center gap-4">
                    <button onclick="resetApp()" class="px-6 py-3 bg-white border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50 font-bold text-sm transition-colors shadow-sm">
                        <i class="fa-solid fa-rotate-left mr-2"></i>Nueva Consulta
                    </button>
                    <!-- BOTN CANCELACIN NO EXITOSA (ROJO) -->
                    <button onclick="registerFail()" class="px-6 py-3 bg-red-600 text-white rounded-lg font-bold text-sm transition-transform shadow-lg hover:bg-red-700 hover:-translate-y-0.5">
                         <i class="fa-solid fa-thumbs-down mr-2"></i> Cancelaci贸n no exitosa
                    </button>
                    <!-- BOTN PROCESO DE CANCELACIN (VERDE) -->
                    <button onclick="openCancelModal()" class="px-6 py-3 bg-green-600 text-white rounded-lg font-bold text-sm transition-transform shadow-lg hover:bg-green-700 hover:-translate-y-0.5">
                         <i class="fa-solid fa-ban mr-2"></i> Proceso de Cancelaci贸n
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- MODAL TABLA COMPARATIVA -->
    <div id="tableModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-6xl h-4/5 flex flex-col overflow-hidden animate-fade-in-up">
            <div class="bg-coppel-blue text-white p-4 flex justify-between items-center">
                <div class="flex items-center gap-2">
                    <i class="fa-solid fa-table"></i>
                    <h2 class="text-lg font-bold">Tabla Comparativa - Veracruz</h2>
                </div>
                <div class="flex gap-2">
                    <!-- Bot贸n para ver todo si est谩 filtrado -->
                    <button id="showAllBtn" onclick="renderTable(null)" class="hidden bg-blue-700 text-white px-3 py-1 rounded text-xs hover:bg-blue-800 transition-colors">
                        Ver Todos
                    </button>
                    <button onclick="toggleTableModal()" class="text-white hover:text-yellow-300 transition-colors">
                        <i class="fa-solid fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="flex-1 overflow-auto p-4 bg-gray-50">
                <table class="w-full bg-white border-collapse comparison-table shadow-sm">
                    <thead id="tableHead"></thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
            <div class="bg-gray-100 p-4 flex justify-end">
                <button onclick="toggleTableModal()" class="bg-gray-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-gray-700 transition-colors">
                    Cerrar Tabla
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL PROCESO DE CANCELACIN (NUEVO) -->
    <div id="cancelModal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl overflow-hidden animate-fade-in-up relative">
            
            <!-- Header Modal -->
            <div class="bg-red-600 text-white p-4 flex justify-between items-center">
                <h2 class="text-lg font-bold flex items-center gap-2">
                    <i class="fa-solid fa-ban"></i> Proceso de Cancelaci贸n
                </h2>
                <button onclick="closeCancelModal()" class="text-white hover:text-red-200 transition-colors">
                    <i class="fa-solid fa-times text-xl"></i>
                </button>
            </div>

            <!-- Body Modal -->
            <div class="p-6">
                <!-- Opciones (LISTA OCULTA HASTA SELECCIN, MOSTRADA POR DEFECTO EN JS) -->
                <div id="cancel-menu-container">
                    <p class="text-red-600 font-bold text-sm mb-4 animate-pulse">Recuerda recomendar primeramente la cancelaci贸n por la App o el Portal.</p>
                    <div class="grid grid-cols-1 gap-3 mb-6">
                        <button onclick="showCancelSteps('app')" class="w-full flex items-center justify-between p-4 bg-gray-50 hover:bg-blue-50 border border-gray-200 hover:border-blue-300 rounded-lg transition-all group">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xl group-hover:bg-blue-600 group-hover:text-white transition-colors">
                                    <i class="fa-solid fa-mobile-screen"></i>
                                </div>
                                <div class="text-left">
                                    <h3 class="font-bold text-gray-800">App Afore M贸vil</h3>
                                    <p class="text-xs text-gray-500">Autogesti贸n r谩pida</p>
                                </div>
                            </div>
                            <i class="fa-solid fa-chevron-right text-gray-400 group-hover:text-blue-500"></i>
                        </button>

                        <button onclick="showCancelSteps('web')" class="w-full flex items-center justify-between p-4 bg-gray-50 hover:bg-blue-50 border border-gray-200 hover:border-blue-300 rounded-lg transition-all group">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xl group-hover:bg-blue-600 group-hover:text-white transition-colors">
                                    <i class="fa-solid fa-globe"></i>
                                </div>
                                <div class="text-left">
                                    <h3 class="font-bold text-gray-800">Afore Web</h3>
                                    <p class="text-xs text-gray-500">Portal de internet</p>
                                </div>
                            </div>
                            <i class="fa-solid fa-chevron-right text-gray-400 group-hover:text-blue-500"></i>
                        </button>

                        <!-- MODIFICADO: Opacity-60 para indicar fallback -->
                        <button onclick="showCancelSteps('module')" class="w-full flex items-center justify-between p-4 bg-gray-100 border border-gray-200 rounded-lg transition-all group opacity-60 hover:opacity-100 hover:bg-blue-50">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xl group-hover:bg-blue-600 group-hover:text-white transition-colors">
                                    <i class="fa-solid fa-store"></i>
                                </div>
                                <div class="text-left">
                                    <h3 class="font-bold text-gray-800">M贸dulo de Afore</h3>
                                    <p class="text-xs text-gray-500">Atenci贸n presencial (Solo si falla digital)</p>
                                </div>
                            </div>
                            <i class="fa-solid fa-chevron-right text-gray-400 group-hover:text-blue-500"></i>
                        </button>
                    </div>
                </div>

                <!-- Step Display Area -->
                <div id="cancel-steps-display" class="hidden bg-yellow-50 border border-yellow-200 rounded-lg p-4 animate-fade-in-up">
                    <button onclick="goBackToCancelMenu()" class="mb-2 text-xs font-bold text-gray-500 hover:text-blue-600 flex items-center transition-colors">
                        <i class="fa-solid fa-arrow-left mr-1"></i> Volver a opciones
                    </button>
                    <h4 id="cancel-step-title" class="font-bold text-yellow-800 mb-2 border-b border-yellow-200 pb-2"></h4>
                    <div id="cancel-step-content" class="text-sm text-gray-700 leading-relaxed space-y-2"></div>
                </div>

            </div>
        </div>
    </div>

    <!-- SUCCESS SCREEN (Cierre 2 - Retenci贸n Exitosa) -->
    <div id="success-screen" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <!-- MODIFICADO: Layout horizontal rectangular -->
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl overflow-hidden animate-fade-in-up relative p-8">
            
            <button onclick="goBackFromSuccess()" class="absolute top-4 left-4 text-gray-400 hover:text-gray-600 transition-colors z-10">
                <i class="fa-solid fa-arrow-left text-xl"></i>
            </button>

            <div class="flex flex-col md:flex-row gap-8 items-stretch">
                
                <!-- COLUMNA IZQUIERDA: ICONO Y TTULO (Visuales) -->
                <div class="w-full md:w-5/12 text-center flex flex-col items-center justify-center border-b md:border-b-0 md:border-r border-gray-100 pb-6 md:pb-0 md:pr-6">
                    <div class="inline-flex items-center justify-center w-24 h-24 rounded-full bg-green-100 text-green-600 mb-4 animate-float">
                        <i class="fa-solid fa-check text-5xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">隆Retenci贸n Exitosa!</h2>
                    <span class="inline-block bg-green-100 text-green-800 px-4 py-1.5 rounded-full text-sm font-bold uppercase tracking-wider shadow-sm mb-3">
                        <i class="fa-solid fa-star mr-1"></i> Misi贸n Cumplida
                    </span>
                    <p class="text-gray-500 text-sm">El cliente ha confirmado la cancelaci贸n del traspaso.</p>
                </div>

                <!-- COLUMNA DERECHA: GUION DE CIERRE Y ACCIN -->
                <div class="w-full md:w-7/12 flex flex-col justify-between">
                    <div class="bg-green-50 rounded-lg p-5 border border-green-200 shadow-sm text-sm mb-4 flex-grow">
                        <h3 class="text-green-700 font-bold text-xs uppercase mb-3 flex items-center">
                            <i class="fa-solid fa-comment-dots mr-2"></i> Cierre 2 (Despedida)
                        </h3>
                        <div class="space-y-3 text-gray-800 leading-relaxed">
                            <p>"Sr./Sra./Srita. <span class="font-bold text-blue-600">[Nombre del Cliente]</span>, agradezco su tiempo. 隆Ha tomado una excelente decisi贸n!, nos encanta que siga confiando en Afore Coppel."</p>
                            <p>"Le recuerdo que seguimos a su disposici贸n en el <span class="font-bold">55-95-00-00-05</span> en toda la Rep煤blica, de lunes a s谩bado de 8:00am a 10:00pm en hora centro del pa铆s."</p>
                            <p>"Por 煤ltimo, le comento que en Afore Coppel, sus datos est谩n protegidos. Puede consultar nuestro aviso de privacidad en <b>www.aforecoppel.com</b>. As铆 mismo, le informamos que su llamada fue grabada para fines de calidad en el servicio."</p>
                            <p>"De mi parte es un gusto haber conversado con usted, le llamo <span class="font-bold">[Su Nombre y Apellido]</span> de Afore Coppel que tenga excelente d铆a/ tarde / noche."</p>
                        </div>
                    </div>

                    <div class="text-right mt-2">
                        <button onclick="resetApp()" class="bg-blue-600 text-white px-8 py-3 rounded-lg font-bold text-sm shadow-md hover:bg-blue-700 transition-transform hover:-translate-y-0.5 flex items-center justify-center gap-2 ml-auto w-full md:w-auto">
                            <i class="fa-solid fa-rotate-left"></i> Nueva Consulta
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- NO RETENTION SCREEN (Fail) -->
    <div id="fail-screen" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <!-- MODIFICADO: Layout horizontal rectangular para match con Success -->
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl overflow-hidden animate-fade-in-up relative p-8">
            
            <!-- Bot贸n de retroceso -->
            <button onclick="goBackFromFail()" class="absolute top-4 left-4 text-gray-400 hover:text-gray-600 transition-colors z-10">
                <i class="fa-solid fa-arrow-left text-xl"></i>
            </button>
            <!-- BOTN DE CIERRE (X) ELIMINADO -->

            <div class="flex flex-col md:flex-row gap-8 items-stretch">
                
                <!-- COLUMNA IZQUIERDA: ICONO Y TTULO (Visuales) -->
                <div class="w-full md:w-5/12 text-center flex flex-col items-center justify-center border-b md:border-b-0 md:border-r border-gray-100 pb-6 md:pb-0 md:pr-6">
                    <div class="inline-flex items-center justify-center w-24 h-24 rounded-full bg-red-100 text-red-600 mb-4">
                        <i class="fa-solid fa-times text-5xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Retenci贸n No Exitosa</h2>
                    <p class="text-gray-500 mt-2 text-sm">El cliente ha decidido continuar con el traspaso.</p>
                </div>

                <!-- COLUMNA DERECHA: GUION Y ACCIN -->
                <div class="w-full md:w-7/12 flex flex-col justify-between">
                    <div class="bg-red-50 rounded-lg p-5 border border-red-200 shadow-sm text-sm mb-4 flex-grow">
                        <h3 class="text-red-700 font-bold text-xs uppercase mb-3 flex items-center">
                            <i class="fa-solid fa-comment-slash mr-2"></i> Despedida Institucional
                        </h3>
                        <div class="space-y-3 text-gray-800 leading-relaxed">
                             <p>"Agradezco su atenci贸n. Si cambia de parecer le recuerdo que estamos disponibles para usted en el <span class="font-bold">55-95-00-00-05</span> en toda la Rep煤blica, de lunes a s谩bado de 8:00am a 10:00pm en hora centro del pa铆s."</p>
                            <p>"Le atendi贸 <span class="font-bold">[Su Nombre y Apellido]</span> de Afore Coppel, 隆Que tenga un excelente d铆a/tarde/noche!"</p>
                        </div>
                    </div>

                    <div class="text-right mt-2">
                        <button onclick="resetApp()" class="bg-gray-600 text-white px-8 py-3 rounded-lg font-bold text-sm shadow-md hover:bg-gray-700 transition-transform hover:-translate-y-0.5 flex items-center justify-center gap-2 ml-auto w-full md:w-auto">
                            <i class="fa-solid fa-rotate-left"></i> Finalizar y Reiniciar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        // --- DATA MATRIX DE COMPARACIN ---
        const comparisonMatrix = {
            categories: [
                { id: 'consar', label: 'Confianza (Monitor CONSAR)' }, // FIRST POSITION
                { id: 'presence', label: 'Presencia en Veracruz' },
                { id: 'wait', label: 'Espera SIN cita' }, // <--- CHANGE LABEL
                { id: 'phone', label: 'Atenci贸n Telef贸nica' },
                { id: 'days', label: 'D铆as de Atenci贸n' },
                { id: 'time', label: 'Atenci贸n con cita' }, // <--- CHANGED FROM 'Tiempo de Tr谩mite'
                { id: 'inclusion', label: 'Inclusi贸n' }
            ],
            coppel: {
                presence: "31 tiendas con Asesor previsional y 21 modulos de auto servicio",
                wait: "60 min m谩ximo",
                phone: "Humanos capacitados",
                days: "Lunes a Domingo",
                time: "gil: 30 min (75%)",
                inclusion: "Prioridad adultos mayores",
                consar: "2do lugar en monitor Afore"
            },
            competitors: {
                profuturo: {
                    presence: "4 m贸dulos (M铆nima)",
                    wait: "120 min (2 horas)",
                    phone: "IA no precisa",
                    days: "Lunes a S谩bado",
                    time: "60 min",
                    inclusion: "Prioridad adultos mayores",
                    consar: "Menor calidad en el servicio"
                },
                banorte: {
                    presence: "6 m贸dulos (Limitada)",
                    wait: "90 min",
                    phone: "Est谩ndar",
                    days: "Lunes a S谩bado",
                    time: "Limitado a 40 min",
                    inclusion: "General",
                    consar: "Menor calidad en el servicio"
                },
                inbursa: {
                    presence: "11 m贸dulos",
                    wait: "60 min",
                    phone: "Est谩ndar",
                    days: "Lunes a Viernes",
                    time: "Limitado a 40 min",
                    inclusion: "General",
                    consar: "Menor calidad en el servicio"
                },
                banamex: {
                    presence: "9 m贸dulos",
                    wait: "90 min",
                    phone: "Tardado",
                    days: "Lunes a Viernes",
                    time: "Limitado a 20 min",
                    inclusion: "Prioridad adultos mayores",
                    consar: "Menor calidad en el servicio"
                },
                azteca: {
                    presence: "7 m贸dulos",
                    wait: "90 min",
                    phone: "Est谩ndar (Web)",
                    days: "Lunes a Domingo",
                    time: "55 min",
                    inclusion: "Prioridad adultos mayores",
                    consar: "Menor calidad en el servicio"
                },
                invercap: {
                    presence: "5 m贸dulos",
                    wait: "90 min",
                    phone: "Est谩ndar",
                    days: "Lunes a Viernes",
                    time: "60 min",
                    inclusion: "General",
                    consar: "Menor calidad en el servicio"
                },
                sura: {
                    presence: "6 m贸dulos",
                    wait: "90 min",
                    phone: "-",
                    days: "Lunes a Viernes",
                    time: "60 min",
                    inclusion: "Prioridad adultos mayores",
                    consar: "Menor calidad en el servicio"
                },
                principal: {
                    presence: "2 m贸dulos",
                    wait: "90 min",
                    phone: "-",
                    days: "L-J / V (Corta)",
                    time: "20 min",
                    inclusion: "General",
                    consar: "Menor calidad en el servicio"
                }
            }
        };

        const competitorNames = {
            profuturo: "Profuturo",
            banorte: "XXI Banorte",
            inbursa: "Inbursa",
            banamex: "Banamex",
            azteca: "Azteca",
            invercap: "InverCap",
            sura: "Sura",
            principal: "Principal"
        };

        // --- GENERIC CONNECTION SCRIPTS ---
        const competitorData = {
            profuturo: { name: "Profuturo", modules: "4 m贸dulos", weakness_desc: "Largas esperas y procesos digitales/robots." },
            banorte: { name: "XXI Banorte", modules: "6 m贸dulos", weakness_desc: "Horarios bancarios r铆gidos." },
            banamex: { name: "Citibanamex", modules: "9 m贸dulos", weakness_desc: "Atenci贸n limitada a 20 min y sin fines de semana." },
            inbursa: { name: "Inbursa", modules: "11 m贸dulos", weakness_desc: "No abre fines de semana." },
            azteca: { name: "Azteca", modules: "7 m贸dulos", weakness_desc: "Saturaci贸n alta." },
            sura: { name: "Sura", modules: "6 m贸dulos", weakness_desc: "Lejan铆a geogr谩fica." },
            principal: { name: "Principal", modules: "2 m贸dulos", weakness_desc: "Cobertura m铆nima." },
            invercap: { name: "InverCap", modules: "5 m贸dulos", weakness_desc: "Cierre temprano (5 PM)." }
        };

        const connectionDialogues = {
            service: "Entiendo perfectamente su situaci贸n, [Nombre], y lamento mucho la experiencia que tuvo. Le ofrezco una sincera disculpa a nombre de Afore Coppel. Mi intenci贸n es ayudarle a resolver esto. Antes de continuar con su solicitud, 驴me permite comentarle un beneficio clave que tenemos para usted?",
            coverage: "Comprendo su decisi贸n, la comodidad es fundamental. Sin embargo, me gustar铆a que valorara un dato importante sobre nuestra disponibilidad aqu铆 en Veracruz comparada con otras opciones. 驴Me permite compartirle esta informaci贸n?",
            returns: "Entiendo que su prioridad es hacer crecer su dinero. Es una decisi贸n financiera importante. Sin embargo, hay factores adicionales como los gastos de traslado que impactan su ahorro real. 驴Me permite explicarle c贸mo funciona esto en su beneficio?"
        };

        const rebuttals = {
            money: {
                text: "Comprendo que el n煤mero llama la atenci贸n. Pero le invito a ver el <b>'Rendimiento Neto'</b>. <br><br>Si la otra Afore le promete un poco m谩s, pero usted gasta $200 en un solo viaje de taxi o cami贸n para ir a verlos... <b>usted ya sali贸 perdiendo</b>. <br><br>Aqu铆 en Coppel, su dinero se queda 铆ntegro porque no gasta en log铆stica. <b>Proteja su ganancia real y no regale su dinero en transporte.</b>",
                closing: "Deme el voto de confianza hoy. Le indico c贸mo cancelar desde su App ahora mismo y usted conserva su tranquilidad."
            },
            distance: {
                text: "Entiendo que hoy, con calma, la distancia no le parezca grave. Pero piense en una <b>emergencia real</b>: <br><br>Si alg煤n d铆a necesita un retiro por desempleo urgente o un tr谩mite m茅dico, tener que viajar a otra ciudad se volver谩 un obst谩culo enorme y estresante. <br><br>Hoy usted tiene un <b>'Seguro de Cercan铆a'</b> con nuestros 31 tiendas con Asesor Previsional y 21 m贸dulos de Auto Servicio. <b>No cancele su tranquilidad futura</b> por un tr谩mite que puede anular hoy.",
                closing: "驴Le parece bien si le gu铆o para que cancele la solicitud en su celular y evitamos futuros dolores de cabeza?"
            },
            bad_service: {
                text: "Le ofrezco una disculpa sincera y personal. Entiendo su molestia. <br><br>Pero le propongo algo: perm铆tame levantar un reporte ahora mismo para corregirlo, pero <b>no castigue su propia comodidad</b> y茅ndose a un lugar con menos sucursales y peores horarios solo por un error nuestro. <br><br>Qu茅dese con los beneficios de los 31 tiendas con Asesor Previsional y 21 m贸dulos de Auto Servicio y d茅jenos arreglar el servicio hoy mismo.",
                closing: "Le invito a que cancelemos el cambio desde su App y yo me encargo personalmente de gestionar su reporte."
            },
            status_quo: {
                text: "Lo entiendo, a veces da pereza hacer tr谩mites. Pero v茅alo as铆: <br><br><b>Cancelar le toma 1 minuto en su celular hoy</b>. Cambiarse a una Afore con pocas sucursales le har谩 perder <b>horas enteras</b> en el futuro cada vez que necesite algo. <br><br>Invierta este minuto conmigo ahora para ahorrarse esas horas de filas y viajes en el futuro.",
                closing: "驴Tiene su celular a la mano? Le voy diciendo los pasos para cancelar, es muy r谩pido."
            }
        };

        const nonContactScenarios = {
            wrong_number: {
                title: "No lo conozco / N煤mero Equivocado / No vive aqu铆",
                script: "Una disculpa por las molestias, este n煤mero se proporcion贸 para poder localizar al Sr./Sra <span class='font-bold text-blue-600'>[Nombre del Titular]</span> ya que tenemos informaci贸n que darle de Afore Coppel, <b>驴Tiene contacto con 茅l/ella para poder dejar un recado con usted?</b>",
                extra: "<b>Si dice NO:</b> Pasar a Cierre 1.<br><b>Si dice S:</b> \"Por favor, com茅ntele que le llamamos de Afore Coppel para informarle que tenemos novedades importantes sobre su cuenta. Adicional, si le llegan a generar molestias las llamadas, le agradecer铆a me apoye coment谩ndole que es necesario que actualice sus datos con nosotros.\""
            },
            not_home: {
                title: "No se encuentra (Dejar Recado)",
                script: "Por favor, com茅ntele al Sr./Sra. <span class='font-bold text-blue-600'>[Nombre del Titular]</span> qu茅 le llamamos de Afore Coppel para informarle que tenemos novedades importantes sobre su cuenta.",
                extra: "Despu茅s de dejar el recado, proceda al <b>Cierre 1</b>."
            },
            deceased: {
                title: "El trabajador falleci贸",
                script: "Lamentamos mucho la p茅rdida del Sr./Srta. <span class='font-bold text-blue-600'>[Nombre del Titular]</span>.",
                extra: "Muestre empat铆a, haga una pausa breve y proceda con respeto al <b>Cierre 1</b>."
            }
        };
        
        // --- DATA DE CANCELACIN ---
        const cancellationSteps = {
            app: {
                title: "Pasos en App Afore M贸vil",
                steps: `
                    <ol class="list-decimal list-inside space-y-2 text-sm text-gray-700">
                        <li>Indique al cliente que abra su aplicaci贸n <b>AforeM贸vil</b>.</li>
                        <li>Debe ir al men煤 de <b>"Servicios"</b> (parte inferior).</li>
                        <li>Seleccionar la opci贸n <b>"Estatus de Traspaso"</b>.</li>
                        <li>Ver谩 su solicitud activa. Debe dar clic en <b>"Cancelar Solicitud"</b>.</li>
                        <li>El sistema le pedir谩 confirmar con su contrase帽a o huella/rostro.</li>
                        <li><b>Listo.</b> Le llegar谩 un folio de cancelaci贸n por SMS/Correo.</li>
                    </ol>
                    <div class="mt-6 text-center">
                        <button onclick="registerSuccess()" class="bg-green-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-green-700 transition-colors shadow-md">
                            <i class="fa-solid fa-check-circle mr-2"></i> Cancelaci贸n Exitosa
                        </button>
                    </div>
                `
            },
            web: {
                title: "Pasos en Afore Web",
                steps: `
                    <ol class="list-decimal list-inside space-y-2 text-sm text-gray-700">
                        <li>Indique al cliente que ingrese a <b>www.aforeweb.com.mx</b>.</li>
                        <li>Debe iniciar sesi贸n con su CURP y contrase帽a.</li>
                        <li>Ir a la secci贸n <b>"Mis Tr谩mites"</b>.</li>
                        <li>Buscar el apartado de <b>"Traspaso en proceso"</b>.</li>
                        <li>Dar clic en el bot贸n <b>"Cancelar Traspaso"</b> y confirmar.</li>
                        <li>Se generar谩 un comprobante de cancelaci贸n descargable.</li>
                    </ol>
                    <div class="mt-6 text-center">
                        <button onclick="registerSuccess()" class="bg-green-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-green-700 transition-colors shadow-md">
                            <i class="fa-solid fa-check-circle mr-2"></i> Cancelaci贸n Exitosa
                        </button>
                    </div>
                `
            },
            module: {
                title: "Pasos en M贸dulo de Afore (Orientar a sucursal mas cercana)",
                steps: `
                    <ul class="list-disc list-inside space-y-2 text-sm text-gray-700">
                        <li>El cliente debe acudir personalmente a cualquier M贸dulo de Afore Coppel.</li>
                        <li><b>Requisitos obligatorios:</b> Llevar su Identificaci贸n Oficial vigente (INE/Pasaporte).</li>
                        <li>Solicitar al ejecutivo la <b>"Cancelaci贸n de Traspaso"</b>.</li>
                        <li>El ejecutivo le entregar谩 un formato impreso que deber谩 firmar.</li>
                        <li>El tr谩mite se procesa en el momento y se le entrega copia de su acuse.</li>
                    </ul>
                    <div class="mt-6 text-center">
                        <button onclick="registerSuccess()" class="bg-green-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-green-700 transition-colors shadow-md">
                            <i class="fa-solid fa-check-circle mr-2"></i> Cancelaci贸n Exitosa
                        </button>
                    </div>
                `
            }
        };

        let currentCompetitor = null;
        let currentReason = null;

        function setReason(reason) {
            currentReason = reason;
            
            // UI Update
            document.querySelectorAll('.reason-btn').forEach(btn => {
                btn.classList.remove('bg-blue-50', 'border-blue-500', 'ring-2', 'ring-blue-200');
                btn.classList.add('border-gray-200');
            });
            
            const selectedBtn = document.getElementById(`btn-${reason}`);
            selectedBtn.classList.remove('border-gray-200');
            selectedBtn.classList.add('bg-blue-50', 'border-blue-500', 'ring-2', 'ring-blue-200');

            generateScript();
        }

        // GENERATE COMPARISON TABLE (DYNAMIC)
        function updateComparisonTable(competitorKey) {
            const card = document.getElementById('data-card');
            const content = document.getElementById('comparison-content');
            const nameDisplay = document.getElementById('comp-name-display');

            if (!competitorKey || !competitorData[competitorKey]) {
                card.classList.add('hidden');
                return;
            }

            card.classList.remove('hidden');
            nameDisplay.textContent = competitorNames[competitorKey];
            
            let html = '';
            const compData = comparisonMatrix.competitors[competitorKey];
            
            comparisonMatrix.categories.forEach(cat => {
                // If Inbursa is selected, skip the 'consar' row
                if (competitorKey === 'inbursa' && cat.id === 'consar') return;

                html += `
                    <div class="border-b border-gray-100 p-2">
                        <p class="font-bold text-gray-500 mb-1" style="font-size: 10px;">${cat.label.toUpperCase()}</p>
                        <div class="flex justify-between items-start gap-2">
                            <div class="w-1/2">
                                <p class="text-red-700 font-medium">${compData[cat.id]}</p>
                            </div>
                            <div class="w-1/2 text-right">
                                <p class="text-blue-700 font-bold">${comparisonMatrix.coppel[cat.id]}</p>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            content.innerHTML = html;
        }

        function generateScript() {
            const selectElement = document.getElementById('competitorSelect');
            currentCompetitor = selectElement.value;

            // Reset UI bits
            closeRebuttal();
            
            // Update the side comparison table automatically
            updateComparisonTable(currentCompetitor);

            if (currentCompetitor && currentReason) {
                // Logic for Script generation
                document.getElementById('opening-script').classList.add('hidden');
                document.getElementById('non-contact-script').classList.add('hidden');
                document.getElementById('success-screen').classList.add('hidden');
                document.getElementById('fail-screen').classList.add('hidden');
                
                const container = document.getElementById('script-container');
                container.classList.remove('hidden');
                container.classList.remove('fade-in');
                void container.offsetWidth; 
                container.classList.add('fade-in');

                const data = competitorData[currentCompetitor];
                document.getElementById('tag-competitor').textContent = `Vs. ${data.name}`;
                
                let reasonText = "";
                if(currentReason === 'service') reasonText = "Servicio";
                if(currentReason === 'coverage') reasonText = "Cobertura / Horarios";
                if(currentReason === 'returns') reasonText = "Rendimientos";
                document.getElementById('tag-reason').textContent = reasonText;

                // USE GENERIC CONNECTION DIALOGUE INSTEAD OF SPECIFIC SCRIPT
                let scriptContent = connectionDialogues[currentReason];
                
                document.getElementById('script-body').innerHTML = `"${scriptContent}"`;

                let closingText = "Si ya le qued贸 clara la informaci贸n, le invito a realizar la cancelaci贸n del tr谩mite para conservar estos beneficios. 驴Le gustar铆a que le gu铆e paso a paso?";
                if (currentReason === 'returns') {
                    closingText = "Tomando en cuenta que aqu铆 su ahorro es neto, le invito a realizar la cancelaci贸n del traspaso para evitar esos gastos hormiga. 驴Le parece bien si le gu铆o paso a paso?";
                } else if (currentReason === 'service') {
                    closingText = "Para que siga disfrutando de la mejor atenci贸n sin horarios limitados, le invito a cancelar su solicitud de cambio ahora mismo. 驴Me permite indicarle c贸mo hacerlo?";
                } else if (currentReason === 'coverage') {
                    closingText = "Valore su tiempo y comodidad. Le invito a realizar la cancelaci贸n para seguir teniendo una sucursal siempre cerca. 驴Le ayudo a hacerlo desde su celular?";
                }
                document.getElementById('script-closing').textContent = closingText;
            }
        }

        function showNonContact(scenarioType) {
            // Ocultar Apertura
            document.getElementById('opening-script').classList.add('hidden');
            // Ocultar Script principal (si estuviera abierto)
            document.getElementById('script-container').classList.add('hidden');
            document.getElementById('success-screen').classList.add('hidden');
            document.getElementById('fail-screen').classList.add('hidden');
            
            // Llenar contenido din谩mico
            const data = nonContactScenarios[scenarioType];
            document.getElementById('nc-title').textContent = data.title;
            document.getElementById('nc-text').innerHTML = `"${data.script}"`;
            document.getElementById('nc-extra').innerHTML = data.extra;

            // Mostrar No Contacto
            const ncContainer = document.getElementById('non-contact-script');
            ncContainer.classList.remove('hidden');
            ncContainer.classList.remove('fade-in');
            void ncContainer.offsetWidth; 
            ncContainer.classList.add('fade-in');
        }

        function showRebuttal(type) {
            const display = document.getElementById('rebuttal-display');
            const text = document.getElementById('rebuttal-text');
            const closing = document.getElementById('rebuttal-closing');
            
            display.classList.remove('hidden');
            text.innerHTML = rebuttals[type].text;
            closing.innerHTML = rebuttals[type].closing;
            
            // Scroll to rebuttal
            display.scrollIntoView({ behavior: 'smooth' });
        }

        function closeRebuttal() {
            document.getElementById('rebuttal-display').classList.add('hidden');
        }

        function copyScript(bodyId, closingId) {
            let textToCopy = "";
            if (bodyId && closingId) {
                const body = document.getElementById(bodyId).innerText;
                const closing = document.getElementById(closingId).innerText;
                textToCopy = `${body}\n\n${closing}`;
            }
            navigator.clipboard.writeText(textToCopy).then(() => {
                const btn = document.querySelector('button[title="Copiar guion"] i');
                btn.classList.remove('fa-copy');
                btn.classList.add('fa-check');
                setTimeout(() => {
                    btn.classList.remove('fa-check');
                    btn.classList.add('fa-copy');
                }, 1000);
            });
        }
        
        function openCancelModal() {
            const modal = document.getElementById('cancelModal');
            modal.classList.remove('hidden');
            document.getElementById('cancel-menu-container').classList.remove('hidden');
            document.getElementById('cancel-steps-display').classList.add('hidden');
        }
        
        function closeCancelModal() {
             document.getElementById('cancelModal').classList.add('hidden');
        }
        
        function showCancelSteps(method) {
            document.getElementById('cancel-menu-container').classList.add('hidden');
            const display = document.getElementById('cancel-steps-display');
            const title = document.getElementById('cancel-step-title');
            const content = document.getElementById('cancel-step-content');
            
            const data = cancellationSteps[method];
            title.textContent = data.title;
            content.innerHTML = data.steps;
            
            display.classList.remove('hidden');
            display.classList.remove('animate-fade-in-up');
            void display.offsetWidth;
            display.classList.add('animate-fade-in-up');
        }
        
        function goBackToCancelMenu() {
            document.getElementById('cancel-steps-display').classList.add('hidden');
            document.getElementById('cancel-menu-container').classList.remove('hidden');
        }

        function registerSuccess() {
            // Cierra el modal de cancelaci贸n
            closeCancelModal();
            
            // Oculta las otras pantallas principales
            document.getElementById('opening-script').classList.add('hidden');
            document.getElementById('script-container').classList.add('hidden');
            document.getElementById('non-contact-script').classList.add('hidden');
            document.getElementById('fail-screen').classList.add('hidden');

            // Muestra la pantalla de 茅xito (Cierre 2)
            const successScreen = document.getElementById('success-screen');
            successScreen.classList.remove('hidden');
            successScreen.classList.remove('fade-in');
            void successScreen.offsetWidth; 
            successScreen.classList.add('fade-in');
        }

        function registerFail() {
            // Cierra el modal de cancelaci贸n si estuviera abierto
            closeCancelModal();
            
            // Oculta las otras pantallas principales
            document.getElementById('opening-script').classList.add('hidden');
            document.getElementById('script-container').classList.add('hidden');
            document.getElementById('non-contact-script').classList.add('hidden');
            document.getElementById('success-screen').classList.add('hidden');

            // Muestra la pantalla de NO 茅xito
            const failScreen = document.getElementById('fail-screen');
            failScreen.classList.remove('hidden');
            failScreen.classList.remove('fade-in');
            void failScreen.offsetWidth; 
            failScreen.classList.add('fade-in');
        }
        
        function closeFailScreen() {
             // Oculta la pantalla de fallo
             document.getElementById('fail-screen').classList.add('hidden');
        }
        
        function goBackFromFail() {
            // Cierra la pantalla de fallo
            document.getElementById('fail-screen').classList.add('hidden');
            
            // Restaura el contenedor de script (Fase 2: Retenci贸n)
            const container = document.getElementById('script-container');
            container.classList.remove('hidden');
            // Reinicia la animaci贸n para que se vea fresco
            container.classList.remove('fade-in');
            void container.offsetWidth; 
            container.classList.add('fade-in');
        }
        
        function goBackFromSuccess() {
            document.getElementById('success-screen').classList.add('hidden');
            const modal = document.getElementById('cancelModal');
            modal.classList.remove('hidden');
        }

        function resetApp() {
            currentReason = null;
            currentCompetitor = null;
            document.getElementById('competitorSelect').selectedIndex = 0;
            
            // Reset UI buttons
            document.querySelectorAll('.reason-btn').forEach(btn => {
                btn.classList.remove('bg-blue-50', 'border-blue-500', 'ring-2', 'ring-blue-200');
                btn.classList.add('border-gray-200');
            });
            
            document.getElementById('data-card').classList.add('hidden');
            document.getElementById('script-container').classList.add('hidden');
            document.getElementById('rebuttal-display').classList.add('hidden');
            document.getElementById('non-contact-script').classList.add('hidden');
            document.getElementById('success-screen').classList.add('hidden');
            document.getElementById('fail-screen').classList.add('hidden');
            
            document.getElementById('opening-script').classList.remove('hidden');
            document.getElementById('opening-script').classList.remove('fade-in');
            void document.getElementById('opening-script').offsetWidth;
            document.getElementById('opening-script').classList.add('fade-in');
        }
        
        // Init
        resetApp();
    </script>
</body>
</html>
